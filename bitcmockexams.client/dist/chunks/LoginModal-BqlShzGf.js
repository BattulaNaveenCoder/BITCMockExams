import{j as e,r as w}from"./react-vendor-DKmEC8F-.js";import{K as P,L as F,c as D,v as A}from"./icons-sFf4zKND.js";import{b as I,a as B}from"../assets/index-D77BABSw.js";import{u as T}from"./auth-EO5UMYcE.js";import{useGoogleLogin as z}from"./oauth-IAnCSk5G.js";import"./jwt-VWaDGczM.js";import"./router-D05wPq9Z.js";import"./http-client-B9ygI19o.js";const _=({children:u,variant:l="primary",size:p="medium",icon:h,onClick:y,type:r="button",disabled:d=!1,loading:n=!1,fullWidth:m=!1,className:j=""})=>{const x="inline-flex items-center justify-center gap-2 font-sans font-semibold border-0 rounded-md cursor-pointer transition-all duration-250 no-underline whitespace-nowrap disabled:opacity-60 disabled:cursor-not-allowed",g={primary:"bg-primary-blue text-white hover:bg-secondary-blue hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0 disabled:hover:transform-none disabled:hover:shadow-none",secondary:"bg-white text-primary-blue border-2 border-primary-blue hover:bg-light-blue hover:-translate-y-0.5 hover:shadow-md disabled:hover:transform-none disabled:hover:shadow-none",outline:"bg-transparent text-primary-blue border-2 border-primary-blue hover:bg-primary-blue hover:text-white disabled:hover:bg-transparent disabled:hover:text-primary-blue",ghost:"bg-transparent text-primary-blue hover:bg-light-blue disabled:hover:bg-transparent",dark:"bg-text-primary text-white hover:bg-text-secondary hover:-translate-y-0.5 hover:shadow-lg disabled:hover:transform-none disabled:hover:shadow-none"},c={small:"px-4 py-2 text-sm",medium:"px-6 py-3 text-base",large:"px-8 py-4 text-lg"},v=m?"w-full":"",f=`${x} ${g[l]} ${c[p]} ${v} ${j}`;return e.jsx("button",{type:r,className:f,onClick:y,disabled:d||n,"aria-busy":n,children:n?e.jsx("span",{className:"w-[1em] h-[1em] border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[h&&e.jsx("span",{className:"flex items-center text-[1.2em]",children:h}),e.jsx("span",{children:u})]})})},L=({label:u,type:l="text",name:p,value:h,onChange:y,placeholder:r,error:d,required:n=!1,disabled:m=!1,className:j="",rows:x=4,enablePasswordToggle:g=!1})=>{const c=`input-${p}`,v=l==="textarea",f=l==="password",[N,S]=w.useState(!1),s="w-full px-4 py-3 font-sans text-base text-text-primary bg-white border-2 border-border rounded-md transition-all duration-150 focus:border-primary-blue focus:outline-none focus:ring-4 focus:ring-primary-blue/10 disabled:bg-bg-light disabled:cursor-not-allowed disabled:opacity-60 placeholder:text-text-light",t=d?"border-error focus:ring-error/10":"",a=v?"resize-y min-h-[100px]":"",o=i=>{y(i)};return e.jsxs("div",{className:`mb-lg ${j}`,children:[u&&e.jsxs("label",{htmlFor:c,className:"block mb-sm font-semibold text-text-primary text-sm",children:[u,n&&e.jsx("span",{className:"text-error ml-1",children:"*"})]}),v?e.jsx("textarea",{id:c,name:p,value:h,onChange:o,placeholder:r,required:n,disabled:m,rows:x,className:`${s} ${t} ${a}`,"aria-invalid":d?"true":"false","aria-describedby":d?`${c}-error`:void 0}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:c,type:f&&g?N?"text":"password":l,name:p,value:h,onChange:o,placeholder:r,required:n,disabled:m,className:`${s} ${t} ${f&&g?"pr-12":""}`,"aria-invalid":d?"true":"false","aria-describedby":d?`${c}-error`:void 0}),f&&g&&e.jsx("button",{type:"button","aria-label":N?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary",onClick:()=>S(i=>!i),tabIndex:0,children:N?e.jsx(P,{}):e.jsx(F,{})})]}),d&&e.jsx("span",{id:`${c}-error`,className:"block mt-sm text-sm text-error",role:"alert",children:d})]})},Q=()=>{const{isOpen:u,close:l,returnUrl:p}=I(),{login:h}=B(),y=T(),[r,d]=w.useState({email:"",password:"",rememberMe:!1}),[n,m]=w.useState({}),[j,x]=w.useState(!1);w.useEffect(()=>{u||(d({email:"",password:"",rememberMe:!1}),m({}),x(!1))},[u]);const g=s=>{s.target===s.currentTarget&&l()};w.useEffect(()=>{const s=t=>{t.key==="Escape"&&u&&l()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[u,l]);const c=s=>{const{name:t,value:a,type:o,checked:i}=s.target;d(b=>({...b,[t]:o==="checkbox"?i:a})),n[t]&&m(b=>({...b,[t]:""}))},v=w.useMemo(()=>()=>{const s={};return r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(s.email="Email is invalid"):s.email="Email is required",r.password?r.password.length<6&&(s.password="Password must be at least 6 characters"):s.password="Password is required",s},[r]),f=async s=>{s.preventDefault();const t=v();if(Object.keys(t).length){m(t);return}x(!0);try{const a={userName:r.email,Password:r.password,isrememberme:r.rememberMe};debugger;const o=await y.login(a,!0),i=o?.data?.token??o?.token;if(!i)throw new Error("Token missing in response");h(i,p),l()}catch(a){const o=!!a?.response,i=a?.response?.status,b=a?.response?.data?.message||a?.response?.data?.error||a?.message,k="Incorrect Password or Email";(o||b)&&console.warn("Login failed:",{status:i,serverMessage:b}),m(C=>({...C,form:k}))}finally{x(!1)}},N=z({scope:"openid email profile",onSuccess:async s=>{debugger;try{const t=s.access_token;if(!t)throw new Error("Google access token not received");const a=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to fetch Google user info");const o=await a.json(),i=(o?.given_name??"").toString(),b=(o?.family_name??"").toString(),k=(o?.email??"").toString(),C=(o?.picture??"").toString();if(!k)throw new Error("Google did not return an email");const M={Provider:"Google",FirstName:i||null,LastName:b||null,EmailAddress:k,Image:C||null,Country:null,PhoneNumber:null,howDidFindUs:null},E=await y.loginWithGoogle(M);if(!E)throw new Error(E?.message||"Google login failed.");const $=E?.token??E?.token;if(!$)throw new Error("Token missing in response");const G=[i,b].filter(Boolean).join(" ")||void 0;h($,p,G),l()}catch(t){m(a=>({...a,form:t?.message||"Google login failed. Please try again."}))}},onError:()=>m(s=>({...s,form:"Google login was cancelled or failed."}))}),S=s=>{{N();return}};return u?e.jsx("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/40 px-4",onMouseDown:g,children:e.jsxs("div",{className:"relative w-full max-w-[520px] bg-white rounded-xl shadow-2xl",onMouseDown:s=>s.stopPropagation(),children:[e.jsx("button",{"aria-label":"Close",className:"absolute right-4 top-4 text-text-secondary hover:text-text-primary",onClick:l,children:e.jsx(D,{})}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:"Welcome Back"}),e.jsx("p",{className:"text-text-secondary m-0",children:"Login using BestITCourses credentials"})]}),e.jsxs("form",{onSubmit:f,className:"mb-4",children:[e.jsx(L,{label:"Email Address",type:"email",name:"email",value:r.email,onChange:c,error:n.email,placeholder:"you@example.com",required:!0}),e.jsx(L,{className:"mt-1",label:"Password",type:"password",name:"password",value:r.password,onChange:c,error:n.password,placeholder:"Enter your password",enablePasswordToggle:!0,required:!0}),e.jsx("div",{className:"flex justify-between items-center mb-6 md:flex-col md:items-start md:gap-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",name:"rememberMe",checked:r.rememberMe,onChange:c}),e.jsx("span",{children:"Remember me"})]})}),n.form&&e.jsx("p",{className:"text-red-600 text-sm mb-3",children:n.form}),e.jsx(_,{type:"submit",variant:"primary",size:"large",fullWidth:!0,loading:j,children:"Login"})]}),e.jsx("div",{className:"relative text-center my-5 before:content-[''] before:absolute before:top-1/2 before:left-0 before:right-0 before:h-px before:bg-border",children:e.jsx("span",{className:"relative bg-white px-4 text-text-light text-sm font-semibold",children:"OR"})}),e.jsx("div",{className:"flex flex-col gap-3 mb-2",children:e.jsxs("button",{className:"flex items-center justify-center gap-4 px-6 py-3 border-2 border-border bg-white rounded-md font-semibold cursor-pointer transition-all duration-250 hover:border-primary-blue hover:bg-light-blue",onClick:()=>S(),children:[e.jsx(A,{className:"text-[#DB4437]"})," Continue with Google"]})}),e.jsx("div",{className:"text-center pt-4 border-t border-border",children:e.jsxs("p",{className:"text-text-secondary m-0",children:["Don't have an account?"," ",e.jsx("a",{href:"https://www.bestitcourses.com/",target:"_blank",rel:"noopener noreferrer",className:"text-primary-blue font-semibold",children:"Sign up"})]})})]})]})}):null};export{Q as default};
